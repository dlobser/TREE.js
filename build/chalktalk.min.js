!function(){var t,e,i,r,n,o,s,a,h,c;t=function(){var t={version:"v.001"};return t}({}),e=function(){return THREE.Material.prototype.setUniform=function(t,e){if(void 0!==this.uniforms[t]){var i=e;if(Array.isArray(e))if(Array.isArray(e[0])){i=[];for(var r=0;r<e.length;r++)i.push(toVec(e[r]))}else i=toVec(e);this.uniforms[t].value=i}},THREE.Object3D.prototype.setMaterial=function(t){isShowingMeshEdges&&(t=bgMaterial()),this.material=t;for(var e=0;e<this.children.length;e++)this.children[e].setMaterial(t);return this},THREE.Object3D.prototype.setOpacity=function(t){this.material.opacity=t,this.material.transparent=!0;for(var e=0;e<this.children.length;e++)this.children[e].setOpacity(t);return this},THREE.Object3D.prototype.getMatrix=function(){return void 0===this.mat&&(this.mat=new M4),this.mat},THREE.Object3D.prototype.setMatrix=function(t){void 0===this.mat&&(this.mat=new M4),this.mat.copy(t._m())},THREE.Object3D.prototype.updateMatrix=function(){if(void 0===this.mat)this.matrix.compose(this.position,this.quaternion,this.scale);else{var t=this.mat._m();this.matrix.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}this.matrixWorldNeedsUpdate=!0},THREE.Object3D.prototype.addTorus=function(t,e,i){var r=torusGeometry(t,e,i),n=new THREE.Mesh(r,bgMaterial());return this.add(n),n},THREE.Object3D.prototype.addLathe=function(t,e){for(var i=[],r=0;r<t.length;r++)i.push(new THREE.Vector3(t[r][0],t[r][1],t[r][2]));var n=latheGeometry(i,e),o=new THREE.Mesh(n,bgMaterial());return this.add(o),o},THREE.Object3D.prototype.addCylinder=function(t){void 0===t&&(t=24);var e=cylinderGeometry(t),i=new THREE.Mesh(e,bgMaterial());return this.add(i),i},THREE.Object3D.prototype.addOpenCylinder=function(t){void 0===t&&(t=24);var e=openCylinderGeometry(t),i=new THREE.Mesh(e,bgMaterial());return this.add(i),i},THREE.Object3D.prototype.addCube=function(){var t=cubeGeometry(),e=new THREE.Mesh(t,bgMaterial());return this.add(e),e},THREE.Object3D.prototype.addPlane=function(){var t=planeGeometry(),e=new THREE.Mesh(t,bgMaterial());return this.add(e),e},THREE.Object3D.prototype.addGlobe=function(t,e,i,r,n,o){void 0===t&&(t=32),void 0===e&&(e=floor(t/2));var s=globeGeometry(t,e,i,r,n,o),a=new THREE.Mesh(s,bgMaterial());return this.add(a),a},THREE.Object3D.prototype.addNode=function(){var t=new THREE.Mesh;return this.add(t),t},THREE.Geometry.prototype.computeEdges=function(){function t(t,r,n){var o=Math.min(r,n)+","+Math.max(r,n);void 0===e[o]?e[o]=i:t.push([e[o],i,[r,n]])}this.edges=[];for(var e={},i=0;i<this.faces.length;i++){var r=this.faces[i];t(this.edges,r.a,r.b),t(this.edges,r.b,r.c),t(this.edges,r.c,r.a)}},THREE.Object3D.prototype.toStrokes=function(){return edgesToStrokes(this.projectVisibleEdges(this.findVisibleEdges()))},THREE.Object3D.prototype.findBoundsWorld=function(t){void 0===t&&(this.updateMatrixWorld(),t=[1e4,1e4,1e4,-1e4,-1e4,-1e4]),this.geometry.matrixWorld=this.matrixWorld,this.geometry.expandBoundsWorld(t);for(var e=0;e<this.children.length;e++)this.children[e].findBoundsWorld(t);return t},THREE.Object3D.prototype.findVisibleEdges=function(t){void 0===t&&(this.updateMatrixWorld(),t=[]),this.geometry.matrixWorld=this.matrixWorld,t.push([this.geometry,this.geometry.findVisibleEdges()]);for(var e=0;e<this.children.length;e++)this.children[e].findVisibleEdges(t);return t},THREE.Object3D.prototype.projectVisibleEdges=function(t){function e(t){return[projectX(t.x),projectY(t.y)]}function i(t){n.push([e(t)])}function r(t){var i=n[n.length-1],r=e(t);i[0][0]==r[0]&&i[0][1]==r[1]?n.splice(n.length-1,1):i.push(r)}for(var n=[],o=new THREE.Vector3,s=new THREE.Vector3,a=0;a<t.length;a++)for(var h=t[a][0],c=t[a][1],u=0;u<c.length;u++){var l=h.vertexWorld(c[u][0]),d=h.vertexWorld(c[u][1]),f=l.distanceTo(d),p=max(1,floor(f/.03));s.copy(l);var v=this.isHiddenPoint(s);v||i(s);for(var E=1;p>=E;E++){o.copy(s),s.copy(l).lerp(d,E/p);var g=this.isHiddenPoint(s);!v&&g&&r(o),v&&!g&&i(s),v=g}v||r(s)}return n},THREE.Object3D.prototype.isHiddenPoint=function(t){if(this.geometry.isHiddenPoint(t))return!0;for(var e=0;e<this.children.length;e++)if(this.children[e].isHiddenPoint(t))return!0;return!1},THREE.Geometry.prototype.expandBoundsWorld=function(t){for(var e=0;e<this.vertices.length;e++){var i=this.vertexWorld(e);t[0]=min(t[0],i.x),t[1]=min(t[1],i.y),t[2]=min(t[2],i.z),t[3]=max(t[3],i.x),t[4]=max(t[4],i.y),t[5]=max(t[5],i.z)}},THREE.Geometry.prototype.findVisibleEdges=function(){var t=[];void 0===this.edges&&this.computeEdges();for(var e=(new THREE.Matrix3).getNormalMatrix(this.matrixWorld),i=0;i<this.faces.length;i++){var r=this.faces[i];void 0===r.viewNormal&&(r.viewNormal=new THREE.Vector3),r.viewNormal.copy(r.normal).applyMatrix3(e).normalize()}for(var i=0;i<this.edges.length;i++){var n=this.edges[i],o=this.faces[n[0]].viewNormal,s=this.faces[n[1]].viewNormal;(o.z>=-1e-4&&s.z<=1e-4||o.z<=1e-4&&s.z>=-1e-4||o.dot(s)<.5)&&t.push(n[2])}return ___hiddenpoint_count=0,t},THREE.Geometry.prototype.vertexWorld=function(t){return void 0===this.verticesWorld&&(this.verticesWorld=[]),void 0===this.verticesWorld[t]&&(this.verticesWorld[t]=new THREE.Vector3),this.verticesWorld[t].copy(this.vertices[t]).applyMatrix4(this.matrixWorld)},THREE.Geometry.prototype.addLine=function(t,e,i){var r=i.x-e.x,n=i.y-e.y,o=sqrt(r*r+n*n);r*=t/2/o,n*=t/2/o,this.vertices.push(new THREE.Vector3(e.x+n,e.y-r,e.z+t)),this.vertices.push(new THREE.Vector3(i.x+n,i.y-r,i.z+t)),this.vertices.push(new THREE.Vector3(i.x-n,i.y+r,i.z+t)),this.vertices.push(new THREE.Vector3(e.x-n,e.y+r,e.z+t));var s=this.vertices.length;this.faces.push(new THREE.Face3(s-4,s-3,s-2)),this.faces.push(new THREE.Face3(s-2,s-1,s-4))},THREE.Geometry.prototype.isHiddenPoint=function(t){for(var e=0;e<this.faces.length;e++)if(this.isPointHiddenByFace(t,e))return ___hiddenpoint_count++,!0;return!1},THREE.Geometry.prototype.isPointHiddenByFace=function(t,e){var i=this.faces[e];return isPointHiddenByTriangle(t,this.vertexWorld(i.a),this.vertexWorld(i.b),this.vertexWorld(i.c))},THREE.Material.prototype.setAmbient=function(t,e,i){return this.emissive=newColor(t,e,i),this},THREE.Material.prototype.setDiffuse=function(t,e,i){return this.color=newColor(t,e,i),this},THREE.Material.prototype.setSpecular=function(t,e,i,r){return this.specular=newColor(t,e,i),this.shininess=r,this},THREE}(),i=function(){var e=t;return e.Utils={extend:function(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t},isUndef:function(t){return void 0===t},isDef:function(t){return!(void 0===t)},arraysEqual:function(t,e){if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0},cloneArray:function(t){for(var e=[],i=0;i<t.length;i++)e[i]=t[i]instanceof Array?cloneArray(t[i]):t[i];return e},arrayToString:function(t,e){if(0==t.length)return"[]";void 0===e&&(e=0);for(var i=0==e?" ":"",r="["+i,n=0;n<t.length;n++)r+=(t[n]instanceof Array?arrayToString(t[n],e+1):t[n])+i+(n<t.length-1?","+i:"]");return r},firstUndefinedArrayIndex:function(t){for(var e=0;e<t.length&&isDef(t[e])&&null!==t[e];)e++;return e},getIndex:function(t,e){for(var i=t.length;--i>=0&&t[i]!==e;);return i},sample:function(t,e){e=max(0,min(.999,e));var i=t.length;if(1==i)return t[0];var r=floor((i-1)*e),n=(i-1)*e-r;return lerp(n,t[r],t[r+1])},newZeroArray:function(t){for(var e=[],i=0;t>i;i++)e.push(0);return e},findSyntaxError:function(t){var e=[],i=onerror;onerror=function(t,i,r){e=[r,t.replace("Uncaught ","")]};var r=document.createElement("script");return r.appendChild(document.createTextNode(t)),document.body.appendChild(r),onerror=i,e},sphere:function(t,e,i){return new THREE.Mesh(new THREE.SphereGeometry(t,e,i),new THREE.MeshLambertMaterial)},vec:function(t,e,i){return new THREE.Vector3(t,e,i)},zeroVec:function(){return new THREE.Vector3(0,0,0)},vecToString:function(t){return"("+t.x+","+t.y+","+t.z+")"},toVec:function(t){switch(t.length){default:return new THREE.Vector2(t[0],t[1]);case 3:return new THREE.Vector3(t[0],t[1],t[2]);case 4:return new THREE.Vector4(t[0],t[1],t[2],t[3])}},hexChar:function(t){return String.fromCharCode((10>t?48:87)+t)},hex:function(t){return this.hexChar(t>>4)+this.hexChar(15&t)},isNumeric:function(t){return!isNaN(t)},roundedString:function(t,e){var i=void 0===e?2:e;"string"==typeof t&&(t=parseFloat(t));var r=0>=i?1:1==i?10:2==i?100:1e3,n=""+Math.floor(r*Math.abs(t)+.5)/r;if(void 0!==e&&i>0){var o=n.indexOf(".");for(0>o&&(n+=".",o=n.length-1);n.length-o<i+1;)n+="0"}return(0>t?"-":"")+n},lineIntersectLine:function(t,e,i,r){function n(t){return t[0]*c[0]+t[1]*c[1]}var o=[t.x,t.y],s=[e.x,e.y],a=[i.x,i.y],h=[r.x,r.y],c=[s[1]-o[1],o[0]-s[0]],u=n(s),l=n(a),d=n(h);if(l>u==d>u)return null;var f=(u-l)/(d-l),p=[lerp(f,a[0],h[0]),lerp(f,a[1],h[1])];c=[s[0]-o[0],s[1]-o[1]];var v=n(p),E=n(o);u=n(s);var g=new THREE.Vector3(p[0],p[1],0);return v>=E&&u>=v?g:null},ik:function(t,e,i,r){var n=i.clone(),o=r.clone(),s=n.dot(n),a=(1+(t*t-e*e)/s)/2,h=n.dot(o)/s;return n.multiplyScalar(h),o.sub(n),h=Math.sqrt(Math.max(0,t*t-s*a*a)/o.dot(o)),new THREE.Vector3(a*i.x+h*o.x,a*i.y+h*o.y,a*i.z+h*o.z)}},e}(),r=function(){var e=t;return e.CTObject=function(t){this.args=t||{},THREE.Object3D.call(this),this.strokes=[],this.boundingBox={},this.inValue=this.args.inValue||null,this.inValues=this.args.inValues||[],this.outValue=null,this.update=!0,this.evaluator=this.args.evaluator||function(t){return t},this.ports=[],void 0===e.CTObject.count?e.CTObject.count=1:e.CTObject.count++},e.Utils.extend(e.CTObject,THREE.Object3D),e.CTObject.prototype.objectCount=function(){return e.CTObject.count},e.CTObject.prototype.setInValue=function(t,e){e||this.inValues.length;this.inValues[e]=t},e.CTObject.prototype.getOutValue=function(){return this.update,this.evaluate(),this.outValue},e.CTObject.prototype.evaluate=function(){this.portsToValues(),this.outValue=this.evaluator(this.inValues)},e.CTObject.prototype.portsToValues=function(){for(var t=0;t<this.ports.length;t++)this.setInValue(this.ports[t].getOutValue(),t)},e.CTObject.prototype.getPort=function(t){return e.Utils.isDef(this.ports[t])?this.ports[t]:null},e.CTObject.prototype.getPortValue=function(t){return e.Utils.isDef(this.ports[t])?this.ports[t].getOutValue():null},e.CTObject.prototype.setPortValue=function(t,i){e.Utils.isDef(this.ports[i])&&this.ports[i].setInValue(t)},e.CTObject.prototype.addPort=function(t){var i=t||{},r=i.portIndex||this.ports.length,n=i.position||e.Utils.zeroVec(),o=i.rotation||new THREE.Euler(0,0,0),s=i.scale||e.Utils.zeroVec(),a=new e.Port;a.position=n,a.rotation=o,a.scale=s,this.ports.splice(r,0,a)},e.CTObject.prototype.removePort=function(){this.ports.splice(portIndex,1)},e}(),n=function(t){return t.Port=function(t){this.args=t||{},THREE.Object3D.call(this),this.strokes=[],this.boundingBox={},this.inValue=null,this.outValue=null,this.update=!0,this.evaluator=this.args.evaluator||function(t){return t}},t.Utils.extend(t.Port,THREE.Object3D),t.Port.prototype.setInValue=function(e){t.Utils.isDef(e)&&(this.inValue=e),this.outValue=this.evaluator(this.inValue)},t.Port.prototype.processValue=function(t){var e=t||this.evaluator,i=null;this.inValue.getOutValue?(this.inValue.evaluate(),i=this.inValue.getOutValue()):i=this.inValue,this.outValue=e(i)},t.Port.prototype.getOutValue=function(){return this.update&&this.processValue(),this.outValue},t}(t),o=function(){var e=t;return e.Sketch=function(t){this.args=t||{},e.CTObject.call(this,t)},e.Utils.extend(e.Sketch,e.CTObject),e.Sketch.prototype.evalCode=function(t,e,i,r){function n(t){return void 0===t?0:t}void 0===e&&(e=n(this.inValues[0])),void 0===i&&(i=n(this.inValues[1])),void 0===r&&(r=n(this.inValues[2])),-1==t.indexOf("return")&&(t="return "+t);var o=null;try{o=Function("me","x","y","z",t)(this,e,i,r)}catch(s){}return this.outValue=o,o},e}(),s=function(){var e=t;return e.obj=function(){this.publicVar=Math.PI,void 0==e.obj.count?e.obj.count=1:e.obj.count++},e.obj.prototype={objectCount:function(){console.log(e.obj.count)},_privateVar:36,get privateVar(){return this._privateVar},set privateVar(t){"number"==typeof t?this._privateVar=t:console.log("NaN")}},e}(),a=function(e){var i=t;i.UI=function(t,e){e||(e={}),this.vectors=e.vectors||[],this.ctrls=e.ctrls||[],this.ctrlAmount=e.ctrlAmount||10,this.setVec=e.setVec||[],this.lerpColors=[],this._drawLine=!1,this._moveCtrl=-1,this.init(),this.Utils=r};var r={dist:function(t,e){var i=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return Math.sqrt(i*i+r*r)},lerp:function(t,e,i){return t+(e-t)*i}};return i.UI.prototype={init:function(t,e){this.width=t||300,this.height=e||300;{var i='<canvas id="canvasID"></canvas>';document.getElementById("canvasDiv").innerHTML=i}this.cDiv=document.getElementById("canvasDiv"),this.c=document.getElementById("canvasID"),this.c.width=this.width,this.c.height=this.height,this.ctx=this.c.getContext("2d"),this.setVectors(),this.addEventListeners(),this.drawVectors()},initScene:function(){this.camera=new THREE.OrthographicCamera(0,this.width,0,this.height,1,1e4),this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer({alpha:!0}),this.renderer.setClearColor(10066329,1),this.renderer.setSize(this.width,this.height),console.log(this.cDiv),this.cDiv.appendChild(this.renderer.domElement),this.camera.position.z=300,this.camera.lookAt(new THREE.Vector3(0,0,0)),this.scene.add(new THREE.AmbientLight(2236962)),console.log(e.Utils),console.log(this),this.standin=[];for(var t=0;3>t;t++)this.standin[t]=new i.Sketch,this.standin[t].outValue=t,this.standin[t].add(e.Utils.sphere(10)),this.scene.add(this.standin[t]);this.light=new THREE.PointLight(16777215),this.light.position.copy(this.camera.position),this.scene.add(this.light),this.counter=0,this.objects=[],this.animate3D(),this.animate2D()},animate3D:function(){this.renderer.render(this.scene,this.camera),requestAnimationFrame(this.animate3D.bind(this))},animate2D:function(){var t=this;this.background(),this.scene.children.forEach(function(e){"undefined"!=typeof e.outValue&&(t.ctx.save(),t.ctx.beginPath(),t.ctx.translate(e.position.x,e.position.y),t.ctx.arc(0,0,5,0,2*Math.PI,!1),t.ctx.fillStyle="#f000ff",t.ctx.fill(),t.ctx.stroke(),t.ctx.font="bold 16px Arial",t.ctx.fillText(e.outValue,0,0),t.ctx.restore())}),requestAnimationFrame(this.animate2D.bind(this))},addEventListeners:function(){var t=this;this.c.addEventListener("mousedown",function(){t._drawLine=!0,i.UI.isDrawing=!0},!1),this.c.addEventListener("mouseup",function(){t._drawLine=!1,i.UI.isDrawing=!1,t._moveCtrl=-1},!1),this.c.addEventListener("mouseout",function(){t._drawLine=!1,i.UI.isDrawing=!1,t._moveCtrl=-1,console.log("out")},!1),this.c.addEventListener("mousemove",function(e){var i=t.getMousePos(e);if(t._drawLine)for(var r=new THREE.Vector3(i.x,i.y,0),n=0,o=1,s=0;s<t.standin.length;s++)console.log(r.distanceTo(t.standin[s].position)<20),r.distanceTo(t.standin[s].position)<20&&(n=s+1,n>t.standin.length-1&&(n=0),o=s+2,o>t.standin.length-1&&(o=0),t.standin[s].position.x=i.x,t.standin[s].position.y=i.y,t.standin[s].evalCode("x*y",t.standin[n].outValue,t.standin[o].outValue),s=t.standin.length)},!1)},getMousePos:function(t){var e=this.c.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}},setVectors:function(){},background:function(t){var e=t||"#558899";this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.width,this.height)},drawVectors:function(){for(var t=1;t<this.vectors.length;t++){this.ctx.beginPath();var e=this.vectors[t-1];this.ctx.lineTo(e.x,e.y);var e=this.vectors[t];this.ctx.lineTo(e.x,e.y),this.ctx.stroke()}for(var t=0;t<this.ctrls.length;t++)ctx.transform(1,0,0,1,this.ctrls[t].x,this.ctrls[t].y),this.ctx.beginPath(),this.ctx.arc(0,0,5,0,2*Math.PI,!1),this.ctx.fillStyle="#ffffff",this.ctx.fill(),this.ctx.stroke(),this.ctx.restore()},paintColors:function(t){var e=this.ctx.createImageData(this.resX,this.resX),i=e.data,r=[];colors=[];for(var n=t||.03,o=12*t||1,s=22*t||1,a=0;a<this.resX;a++)for(var h=0;h<this.resY;h++){var c=.5+noise(10+a*n,10+h*n,n*h),u=.5+noise(a*n*o,h*n*o,n*h),l=.5+noise((-s+n+20+a)*n*s,(s+20+h)*n*s,n*h),d=(2+Math.sin(c*Math.PI*1.5))/3,f=(2+Math.sin(u*Math.PI*1.5))/3,p=(2+Math.sin(l*Math.PI*1.5))/3,v=1;r.push([d*v*255,f*v*255,p*v*255,255])}for(var E=0,a=0;a<i.length;a++)i[a]=r[E][0],i[++a]=r[E][1],i[++a]=r[E][2],i[++a]=r[E][3],E++;i[0]=.5,i[1]=.5,i[2]=.5,i[3]=.5,this.imageData=r,this.ctx.putImageData(e,0,0)},update:function(){this._drawLine&&console.log(this.ctrls)}},i}(i),h=function(t){return console.log("hi"),window.CT=t,t}(t),requirejs.config({paths:{THREE:"../deps/three"},shim:{THREE:{exports:"THREE"}}}),requirejs(["main"]),c=void 0}();